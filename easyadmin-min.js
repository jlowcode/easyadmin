/**
 * Easy Admin
 *
 * @copyright: Copyright (C) 2024 Jlowcode Org - All rights reserved.
 * @license  : GNU/GPL http://www.gnu.org/copyleft/gpl.html
 */
define(["jquery","fab/list-plugin","lib/debounce/jquery.ba-throttle-debounce"],(function(jQuery,FbListPlugin,debounce){var FbListEasyadmin=new Class({Extends:FbListPlugin,options:{inputSearch:"",labelList:"",fatherList:"",valIdEl:0,emptyNameOnList:!0,addNewElement:!1},initialize:function(e){var a=this;this.options=e,Fabrik.addEvent("fabrik.list.submit.ajax.complete",(function(){a.init()})),Fabrik.addEvent("fabrik.list.loaded",(function(){a.init()})),window.addEvent("fabrik.loaded",(function(){a.init()}))},init:function(){var e=this;jQuery(".modal-body").css("overflow-y","scroll"),jQuery(".table").css("table-layout","fixed"),jQuery("#easyadmin_modal___description_list").addClass("fabrikinput"),e.setElementAdminsList(),e.setElementType(),e.setElementApproveByVotes(),e.setElementShowInList(),e.setElementLabelAdvancedLink(),e.setUpButtonSave(),e.setUpButtonsPainel(),e.setUpElementList(),e.sortColumns(),window.location.search.indexOf("manage")>0&&jQuery("#button_"+e.options.idModalList).trigger("click"),jQuery("#modal-list .btn-close").off("click").on("click",(function(){window.location.search.indexOf("manage")>0&&window.location.replace(e.options.baseUri+window.location.pathname.replace("/",""))})),e.options.owner_id==e.options.user.id&&e.options.isAdmin||jQuery("input[name='checkAll']").addClass("fabrikHide"),jQuery("#easyadmin_modal___name").on("input",(function(){const a=jQuery("#easyadmin_modal___name_on_list");e.options.emptyNameOnList&&a.val(this.value)})),jQuery("#easyadmin_modal___name_on_list").on("input",(function(){e.options.emptyNameOnList=!1}))},setUpButtonsPainel:function(){const e=jQuery("th.heading.fabrik_ordercell.fabrik_actions")[0];"inline"==this.options.actionMethod?jQuery(e).find(".btn-group")[0]:jQuery(e).find(".dropdown-menu")[0];this.setButtons(this.options.elements.published),this.setActionPanel(this.options.elements),jQuery(document).ready((function(){jQuery(document).off("mouseenter").on("mouseenter",".heading.fabrik_ordercell",(function(){jQuery(this).find(":button.elementAdminButton").show()})).off("mouseleave").on("mouseleave",".heading.fabrik_ordercell",(function(){jQuery(this).find(":button.elementAdminButton").hide()}))}))},createButton:function(e,a){var t=this,i=jQuery('<a href="#'+t.options.idModal+'" data-bs-toggle="modal">'+a.text()+"</a>"),s=jQuery('<li value="'+e+'" style="min-width: 30px;"></li>').css({cursor:"pointer"});return i.appendTo(s),a.contents().filter((function(){return!this.classList||!this.classList.contains("fabrikorder")&&!this.classList.contains("fabrikorder-asc")&&!this.classList.contains("fabrikorder-desc")})).remove(),a.contents().filter((function(){return!!this.classList&&(this.classList.contains("fabrikorder")||!this.classList.contains("fabrikorder-asc")||!this.classList.contains("fabrikorder-desc"))})).after(s),i.off("click").on("click",(function(){t.setModalToEditElement(this)})),s},setElementDatabasejoin:function(){var e=this;jQuery("#modal-elements .select2-search__field").off("change").on("change",(function(){jQuery(this).remove(),e.options.inputSearch=jQuery(this)})),jQuery(document).off("click").on("click","#modal-elements .select2-selection__choice__remove",(function(){e.options.inputSearch.off("change").on("change",(function(){jQuery(this).remove(),e.options.inputSearch=jQuery(this)})),jQuery(this).parent().remove(),jQuery("#modal-elements .select2-selection__rendered li").append(e.options.inputSearch),e.setUpElementList()})),jQuery("#modal-elements .select2-selection").off("click").on("click",(function(){var a=jQuery(this);0==a.find("#modal-elements .select2-search__field").length&&0==a.find("#modal-elements .select2-selection__rendered li").length&&(a.find("#modal-elements .select2-search").append(e.options.inputSearch),e.setUpElementList())})),this.setUpElementList()},setUpElementList:function(){var e=this,a="#"+e.options.dbPrefix+"fabrik_easyadmin_modal___listas",t=jQuery(a+"-auto-complete"),i=jQuery(a);t.off("focusout").on("focusout",(function(){setTimeout((function(){e.searchElementList()}),500)})),0==jQuery(".refresh_label").length&&(elRefresh=jQuery(e.options.images.refresh),elRefresh.addClass("refresh_label"),elRefresh.css("margin-left","5px"),elRefresh.off("click").on("click",(function(){e.searchElementList()})),i.closest(".fabrikElementContainer").find(".form-label").after(elRefresh))},searchElementList:function(){var self=this,idEl="#"+self.options.dbPrefix+"fabrik_easyadmin_modal___listas",tid=jQuery(idEl).val();if(tid){self.checkRestrictList(tid);var db_table_name=tid,url=this.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=element&plugin=field&method=ajax_fields&showall=1&cid=1&t='"+db_table_name+"'";jQuery.ajax({url:url,method:"get",data:{showRaw:!1,k:2}}).done((function(r){var opts=eval(r),els=document.getElementsByClassName("child-element-list"),notShow=["id","created_by","created_date","created_ip","indexing_text","updated_by","updated_date"];jQuery(".child-element-list").each((function(e,a){jQuery(a).empty()})),Array.each(els,(function(e){x=0,opts.forEach((a=>{if(!notShow.includes(a.value)){e.id.indexOf("label")>0?val=self.options.labelList:val=self.options.fatherList;var t={value:a.value};a.value===val?(t.selected="selected",x=1):"name"==a.value&&e.id.indexOf("___label")>0&&0==x&&(t.selected="selected"),new Element("option",t).set("text",a.label).inject(e)}}))}))})).fail((function(e,a,t){var i={url:url,error:t,status:a,jq:e};self.saveLogs(i)}))}},checkRestrictList:function(e){var a=this,t=this.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=list&plugin=easyadmin&method=checkRestrictList";jQuery.ajax({url:t,method:"get",data:{tableName:e}}).done((function(e){(e=JSON.parse(e)).error&&(alert(e.message),location.reload()),e.restrict?(jQuery("#easyadmin_modal___tags").find('option[value="tags"]').css("display","none"),jQuery("#easyadmin_modal___tags").val("popup_form")):(jQuery("#easyadmin_modal___tags").find('option[value="tags"]').css("display","block"),jQuery("#easyadmin_modal___tags").val("popup_form"))})).fail((function(e,i,s){var o={url:t,error:s,status:i,jq:e};a.saveLogs(o)}))},setElementAdminsList:function(){var e={},a=jQuery("#easyadmin_modal___viewLevel_list").val(),t=this.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=list&plugin=easyadmin&method=getUsersAdmins";e.viewLevel=a,document.querySelectorAll('[name="easyadmin_modal___admins_list[]"]')[0].options.length>0||jQuery.ajax({url:t,method:"post",data:e}).done((function(e){var a=document.querySelectorAll('[name="easyadmin_modal___admins_list[]"]'),t=[];e=JSON.parse(e);for(var i=0;i<a[0].options.length;i++)t.push(a[0].options[i].value);for(const o of e)if(!t.includes(o.id)){var s=[];newOption=new Option(o.name,o.id,!1,!1),jQuery(a).append(newOption).trigger("change");for(i=0;i<a[0].options.length;i++)s.push(a[0].options[i].value);jQuery(a).val(s).trigger("change")}})).fail((function(a,i,s){var o={url:t,data:e,error:s,status:i,jq:a};self.saveLogs(o)}))},setElementType:function(e=""){var a=this,t=jQuery("#easyadmin_modal___type"+e),i=""==e?"#modal-elements":".modalContent";t.find('option[value="user"], option[value="internalid"]').css("display","none"),t.off("change").on("change",(function(e,t){let s=jQuery(this).val(),o=null!=t&&t.sufix;jQuery(i+" .modal-element").each((function(e,a){elementClass=jQuery(this).prop("class"),elementClass.indexOf("element-")<0&&(elementClass.indexOf("type-"+s)<0?jQuery(this).parent().addClass("fabrikHide"):jQuery(this).parent().removeClass("fabrikHide"))})),jQuery('label[for="easyadmin_modal___label_advanced_link"]').trigger("click",{button:"edit-element",sufix:""}),("_wfl"===o||a.options.addNewElement)&&(jQuery("#easyadmin_modal___trash").closest(".fabrikElementContainer").addClass("fabrikHide"),jQuery("#easyadmin_modal___trash"+o).closest(".fabrikElementContainer").addClass("fabrikHide"))})),type=t.val(),jQuery(i+" .modal-element").each((function(e,a){elementClass=jQuery(this).prop("class"),elementClass.indexOf("element-")<0&&(elementClass.indexOf("type-"+type)<0?jQuery(this).parent().addClass("fabrikHide"):jQuery(this).parent().removeClass("fabrikHide"))}))},setElementVisibilityList:function(){var e=this;jQuery("#easyadmin_modal___visibility_list").off("change").on("change",(function(a,t){e.showHideElements("visibility_list","list","dropdown")})),jQuery("#easyadmin_modal___visibility_list").trigger("change")},setElementApproveByVotes:function(){var e=this;jQuery('input[name="easyadmin_modal___approve_by_votes_list"]').off("change").on("change",(function(a,t){e.showHideElements("approve_by_votes_list","list","yesno")})),jQuery('input[name="easyadmin_modal___approve_by_votes_list"]').trigger("change")},setElementShowInList:function(){var e=this;jQuery('input[name="easyadmin_modal___show_in_list"]').off("change").on("change",(function(a,t){0==e.options.valIdEl&&void 0===t||e.showHideElements("show_in_list","element","yesno")}))},setElementLabelAdvancedLink:function(e=""){var a=this,t=jQuery('label[for="easyadmin_modal___label_advanced_link'+e+'"]');t.off("click").on("click",(function(t,i){id=jQuery(this).attr("for").split("___")[1],e=null!=i?i.sufix:"",e=id.indexOf("_wfl")>0?"_wfl":"",a.showHideElements(id,"element","label",i,e)})),t.hover((function(){$(this).css({cursor:"pointer"})}),(function(){$(this).css({cursor:"default"})}))},showHideElements:function(e,a,t,i="",s=""){var o=""==s?"#modal-elements":".modalContent";"list"==a&&(o="#modal-list"),jQuery(o+" .modal-"+a).each((function(){if(elementClass=jQuery(this).prop("class"),elementClass.indexOf(a+"-"+e)>0){switch(t){case"yesno":show=!!jQuery("#easyadmin_modal___"+e+"1").prop("checked")||"";break;case"dropdown":show=jQuery("#easyadmin_modal___"+e).val();break;case"label":"edit-element"==i.button?show=!1:show=jQuery(this).parent().prop("class").indexOf("fabrikHide")>0&&"link"==jQuery("#easyadmin_modal___type").val()}"visibility_list"==e&&(show="3"==show),show?jQuery(this).parent().removeClass("fabrikHide"):jQuery(this).parent().addClass("fabrikHide")}}))},setUpButtonSave:function(){var e=this;elSaveElements=jQuery("#easyadmin_modal___submit_elements"),elSaveList=jQuery("#easyadmin_modal___submit_list"),elSaveElements.off("click").on("click",debounce(2500,!0,(function(a){var t=jQuery(this);t.prop("disabled",!0),e.saveEvent("elements","",t)}))),elSaveList.off("click").on("click",debounce(2500,!0,(function(a){var t=jQuery(this);t.prop("disabled",!0),e.saveEvent("list","",t)})))},saveEvent:function(e,a="",t=""){self=this,valEls={},inputs=jQuery(".fabrikinput");var i="list"==e?"list":"elements";Fabrik.loader.start(jQuery("#modal-"+i+" .modal-content"),Joomla.JText._("COM_FABRIK_LOADING")),listId=jQuery("[name=listid]").val(),db_table_name=jQuery("[name=db_table_name]").val(),history_type=jQuery("[name=history_type]").val(),valEls.easyadmin_modal___mode=e,valEls.easyadmin_modal___listid=listId,valEls.easyadmin_modal___history_type=history_type,valEls.jform={db_table_name:db_table_name},valEls.easyadmin_modal___valIdEl="columns"==e?a.idAtual:self.options.valIdEl,inputs.each((function(){switch(id=this.id,id){case"easyadmin_modal___use_filter1":case"easyadmin_modal___required1":case"easyadmin_modal___trash1":case"easyadmin_modal___show_in_list1":case"easyadmin_modal___show_down_thumb1":case"easyadmin_modal___ajax_upload1":case"easyadmin_modal___multi_select1":case"easyadmin_modal___multi_relation1":case"easyadmin_modal___trash_list1":case"easyadmin_modal___workflow_list1":case"easyadmin_modal___approve_by_votes_list1":case"easyadmin_modal___comparison_list1":case"easyadmin_modal___white_space1":id=id.replace("1",""),valEls[id]=!!jQuery(this).prop("checked")||"";break;case"easyadmin_modal___options_dropdown":valEls[id]=jQuery(this).val().join(",");break;case"easyadmin_modal___description_list":valEls[id]=tinyMCE.activeEditor.getContent();break;default:valEls[id]=jQuery(this).val()}}));var s=jQuery("#jlow_fabrik_easyadmin_modal___thumb_list").attr("value");if(void 0!==s&&(valEls.jlow_fabrik_easyadmin_modal___thumb_list=JSON.parse(s)[0]),valEls.easyadmin_modal___admins_list=jQuery('[name="easyadmin_modal___admins_list[]"]').val(),"list"==e&&(valEls.order_by=[valEls.easyadmin_modal___ordering_list],valEls.order_dir=[valEls.easyadmin_modal___ordering_type_list]),"link"==valEls.easyadmin_modal___type&&0==valEls.easyadmin_modal___valIdEl){var o="";optsOrderingEls=jQuery("#easyadmin_modal___ordering_elements option"),optsOrderingEls.each((function(e,a){o="ID"==a.label||"Criado por"==a.label?a.value:o})),valEls.easyadmin_modal___ordering_elements=o}"columns"==e&&(valEls.easyadmin_modal___ordering_elements=a.idOrder),tinyMCE.activeEditor.save();var n=self.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=list&plugin=easyadmin&method=SaveModal&id=0",l=!1;if(self.options.workflow&&"elements"==e){var r=self.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=form&plugin=workflow&method=hasPermission&id=0";jQuery.ajax({url:r,method:"post",data:valEls}).done((function(e){if(l=JSON.parse(e),valEls.hasPermission=l?"1":"0",l)a=valEls;else{n=self.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=list&plugin=easyadmin&method=validateElements";var a={formData:valEls,requestWorkflow:"1",listid:valEls.easyadmin_modal___listid}}jQuery.ajax({url:n,method:"post",data:a}).done((function(e){e=JSON.parse(e),urlLog=self.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=form&plugin=workflow&method=createLog",e.error?(alert(e.message),t.prop("disabled",!1),Fabrik.loader.stop(jQuery("#modal-list .modal-content")),Fabrik.loader.stop(jQuery("#modal-elements .modal-content"))):self.request(urlLog,valEls,l,t)})).fail((function(e,t,i){var s={url:n,data:a,error:i,status:t,jq:e};self.saveLogs(s)}))})).fail((function(e,a,t){var i={url:r,data:valEls,error:t,status:a,jq:e};self.saveLogs(i)}))}else ownerIdNew=valEls.jlow_fabrik_easyadmin_modal___owner_list,ownerIdNew!=this.options.owner_id&&"list"==e&&window.confirm(Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_MESSAGE_CONFIRM_NEW_OWNER")),self.request(n,valEls,!0,t)},request:function(e,a,t,i){jQuery.ajax({url:e,method:"post",data:a}).done((function(e){(e=JSON.parse(e)).error?alert(e.message):(msg=t?Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_SUCCESS"):e.message,alert(msg),e.updateUrl?window.location.href=self.options.baseUri+e.newUrl:window.location.replace(self.options.baseUri+window.location.pathname.replace("/",""))),i.prop("disabled",!1),Fabrik.loader.stop(jQuery("#modal-list .modal-content")),Fabrik.loader.stop(jQuery("#modal-elements .modal-content"))})).fail((function(t,i,s){var o={url:e,data:a,error:s,status:i,jq:t};self.saveLogs(o)}))},saveLogs:function(e){alert(Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_ERROR")),jQuery.ajax({url:"",method:"post",data:{message:JSON.stringify(e),option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",g:"list",plugin:"easyadmin",method:"saveLogs"}}).done((function(e){location.reload()}))},setButtons:function(e){for(var a in e)if(e.hasOwnProperty(a)&&e[a].enabled&&e[a].show_in_list){var t=jQuery("th."+e[a].fullname).children();t.css({display:"flex"}),t.addClass("tooltip2"),this.createButton(a,t),t.css({"min-width":"120px;"})}},setActionPanel:function(e){if("inline"==this.options.actionMethod)this.setActionPanelInline(e);else{if("dropdown"!=this.options.actionMethod)throw new Error(Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_ACTION_METHOD_ERROR"));this.setActionPanelDropdown(e)}},setActionPanelInline:function(e){var a=this,t=jQuery('<a class="btn fabrik__rowlink btn-default"><span>'+this.options.images.plus+'</span><span class="hidden">'+Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_ADMIN")+"</span></a>"),i=jQuery("th.heading.fabrik_ordercell.fabrik_actions")[0],s=jQuery(i).find(".btn-group")[0],o=jQuery("<div></div>").off("mouseover").on("mouseover",(function(){jQuery(".trashEl").css("display","block")})).off("mouseout").on("mouseout",(function(){jQuery(".trashEl").css("display","none")})),n=jQuery('<li><button id="button_'+a.options.idModalList+'" href="#'+a.options.idModalList+'" data-bs-toggle="modal" type="button">'+Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_EDIT_LIST")+"</button></li>"),l=jQuery('<li><button href="#'+a.options.idModal+'" data-bs-toggle="modal" type="button">'+Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_ADD_ELEMENT")+"</button></li>");if(!s){var r=jQuery('<div class="btn-group"></div>');jQuery(i).find("span").append(r),s=jQuery(i).find(".btn-group")[0]}var d=jQuery(s);d.css("width","200px"),d.css("height","300px"),d.css("overflow-y","auto"),d.css("overflow-x","auto"),this.setCssAndEventsButtons(n,l);var _=jQuery("<div></div>");_.css({"font-size":"12px",position:"absolute","z-index":100,"background-color":"#FFF",display:"none",right:"50%",padding:"10px",border:"2px solid #eee","border-radius":"4px","text-align":"left",width:"150px"}),t.off("click").on("click",(function(){"none"==jQuery(_).css("display")?jQuery(_).css({display:"block"}):jQuery(_).css({display:"none"})})),d.append(t),_.append(l),(a.options.owner_id==a.options.user.id||a.options.isAdmin)&&_.append(n),jQuery.each(e,(function(e,t){if("trash"==e){var i=jQuery('<li style="font-size: 12px; margin: 10px 0px 0px 8px;"></li>').appendTo(o);jQuery(a.options.images.trash).appendTo(i);jQuery("<b>").text(Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_TRASH")).css({"padding-left":"5px",color:"#011627","vertical-align":"middle"}).appendTo(i)}jQuery.each(t,(function(t,i){var s=jQuery('<li value="'+t+'" style="padding-left:10px; font-size: 12px; '+("trash"==e?"display: none":"")+'" class="'+("trash"==e?"trashEl":"")+'"></li>').appendTo("trash"==e?o:_);if(i.enabled)var n=jQuery('<a style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block;" href="#'+a.options.idModal+'" data-bs-toggle="modal"></a>').text(a.options.elementsNames[t]).css({cursor:"pointer","padding-left":"10px"}).appendTo(s);else n=jQuery("<b/>").text(a.options.elementsNames[t]).css({"padding-left":"10px",color:"#999"}).appendTo(s);n.off("click").on("click",(function(){a.setModalToEditElement(this)}))}))})),o.appendTo(_),d.append(_)},setModalToEditElement:function(e){var a=this,t=jQuery(e).parent().prop("value"),i=a.options.allElements[t];a.setRelationshipLockedMessage(),a.options.valIdEl=t,i.enabled&&(a.options.addNewElement=!1,jQuery("#easyadmin_modal___history_type").val(i.type),jQuery.each(i,(function(t,i){if(e=jQuery("#easyadmin_modal___"+t),el2=jQuery("#"+a.options.dbPrefix+"fabrik_easyadmin_modal___"+t),e.length>0||el2.length>0)if(0==(e=0==e.length?el2:e).find(".switcher").length)switch(e.val(i),t){case"label":a.options.labelList=i;break;case"father":a.options.fatherList=i;break;case"listas":jQuery("#"+a.options.dbPrefix+"fabrik_easyadmin_modal___listas").val(i),jQuery("#"+a.options.dbPrefix+"fabrik_easyadmin_modal___listas-auto-complete").val(i);break;case"width_field":case"ordering_elements":a.showHideElements("show_in_list","element","yesno");break;case"options_dropdown":vals=i.split(","),vals.forEach((function(e){jQuery("#easyadmin_modal___"+t).append(jQuery("<option>",{value:e.trim(),text:e.trim(),selected:!0}))}));break;case"name_on_list":a.options.emptyNameOnList=!1}else p=i?1:0,elSw=e.find("#easyadmin_modal___"+t+p),elSw.prop("checked",!0)})),jQuery("#easyadmin_modal___trash").closest(".fabrikElementContainer").removeClass("fabrikHide"));var s=jQuery("#easyadmin_modal___type").val();("treeview"==s||"autocomplete"==s)&&jQuery("#jlow_fabrik_easyadmin_modal___listas-auto-complete").prop("disabled","disabled"),jQuery("#easyadmin_modal___type").trigger("change"),jQuery("#easyadmin_modal___options_dropdown").trigger("chosen:updated"),jQuery('label[for="easyadmin_modal___label_advanced_link"]').trigger("click"),jQuery("#"+a.options.dbPrefix+"fabrik_easyadmin_modal___listas-auto-complete").trigger("focusout"),jQuery("#easyadmin_modal___options_dropdown").parent().find("#easyadmin_modal___options_dropdown_chosen").css("width","95%");var o=jQuery("#easyadmin_modal___white_space");"url"==i.text_format||"link"==i.type||"related_list"==i.type?(o.find("#easyadmin_modal___white_space0").prop("checked",!0),o.closest(".fabrikElementContainer").addClass("fabrikHide")):o.closest(".fabrikElementContainer").removeClass("fabrikHide")},setActionPanelDropdown:function(e){var a=this,t=jQuery("th.heading.fabrik_ordercell.fabrik_actions")[0],i=jQuery(t).find(".dropdown-menu").css("width","100%")[0],s=jQuery("<div></div>").off("mouseover").on("mouseover",(function(){jQuery(".trashEl").css("display","block")})).off("mouseout").on("mouseout",(function(){jQuery(".trashEl").css("display","none")})),o=jQuery('<button id="button_'+a.options.idModalList+'" href="#'+a.options.idModalList+'" data-bs-toggle="modal" type="button">'+a.options.images.pencil+"</button>"),n=jQuery('<li class="subMenuAdmin" style="border-top: 2px solid #eee; padding: 5px 10px 0px 10px;"><button href="#'+a.options.idModal+'" class="addbutton" data-bs-toggle="modal" type="button"><span data-isicon="true" class="fa icon-plus"></span>'+Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_ADD_ELEMENT")+"</button></li>");if(i)jQuery(i).parent().find(".fabrikImg").remove(),jQuery(i).parent().find(".dropdown-toggle").append(a.options.images.plus),jQuery(i).parent().find(".dropdown-toggle").removeClass("btn-default btn-mini"),jQuery(i).parent().find(".fabrikImg").css("margin-left","3px"),jQuery(i).parent().find(".dropdown-toggle").css({"background-color":"rgba(220, 226, 249, 1)","border-radius":"50%",width:"40px",height:"40px",padding:"0px"});else{var l=jQuery('<div class="dropdown fabrik_action"><button class="btn-default dropdown-toggle dropdown-toggle-no-caret" style="background-color: rgba(220, 226, 249, 1); border-radius: 50%; width: 40px; height: 40px;" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+a.options.images.plus+'</button><ul class="dropdown-menu dropdown-menu-end" style="width:100%"></ul></div>');jQuery(t).find("span").append(l),i=jQuery(t).find(".dropdown-menu")[0]}var r=jQuery(i);r.css("width","200px"),r.css("max-height","300px"),r.css("overflow-y","auto"),this.setCssAndEventsButtons(o,n),r.append(n),(a.options.owner_id==a.options.user.id||a.options.isAdmin)&&(jQuery(".header-title button").remove(),jQuery(".header-title").append(o).find("button").css({"margin-left":"32px","background-color":"rgba(220, 226, 249, 1)","border-radius":"50%",width:"40px",height:"40px",padding:"0px","flex-shrink":"0"}).find("img").css({"margin-bottom":"3px"})),jQuery.each(e,(function(e,t){if("trash"==(e=e)){var i=jQuery('<li style="font-size: 12px; margin: 10px 0px 0px 8px;" class="subMenuAdmin"></li>').appendTo(s);jQuery(a.options.images.trash).appendTo(i);jQuery("<b>").text(Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_TRASH")).css({"padding-left":"5px",color:"#011627","vertical-align":"middle"}).appendTo(i)}jQuery.each(t,(function(t,i){var o=jQuery('<li value="'+t+'" style="font-size: 12px; '+("trash"==e?"display: none":"")+'" class="subMenuAdmin '+("trash"==e?"trashEl":"")+" "+i.fullname+'"></li>').appendTo("trash"==e?s:r);if(i.enabled)var n=jQuery('<a style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block;" href="#'+a.options.idModal+'" data-bs-toggle="modal"></a>').text(a.options.elementsNames[t]).css({cursor:"pointer","padding-left":"10px"}).appendTo(o);else n=jQuery("<b/>").text(a.options.elementsNames[t]).css({"padding-left":"10px",color:"#999"}).appendTo(o);n.off("click").on("click",(function(){a.setModalToEditElement(this)}))}))})),s.appendTo(r)},setCssAndEventsButtons:function(e,a){var t=this;a.off("click").on("click",(function(){t.options.addNewElement=!0,t.options.valIdEl=0,jQuery("[name=history_type]").val(""),jQuery("#jlow_fabrik_easyadmin_modal___listas-auto-complete").siblings("p.delete-paragraph").remove(),Els=jQuery("#modal-elements .fabrikinput"),Els.each((function(){switch(id=this.id,id){case"easyadmin_modal___use_filter1":case"easyadmin_modal___required0":case"easyadmin_modal___trash0":case"easyadmin_modal___show_in_list0":case"easyadmin_modal___show_down_thumb0":case"easyadmin_modal___ajax_upload0":case"easyadmin_modal___multi_select0":case"easyadmin_modal___multi_relation0":jQuery(this).prop("checked",!0);break;case"easyadmin_modal___type":case"easyadmin_modal___text_format":jQuery(this).val("text");break;case"easyadmin_modal___format_long_text":jQuery(this).val("0");break;case"easyadmin_modal___tags":jQuery(this).val("popup_form");break;case"easyadmin_modal___access_rating":jQuery(this).val("1");break;case"easyadmin_modal___name_on_list":t.options.emptyNameOnList=!0;break;default:jQuery(this).hasClass("input-list")||jQuery(this).val("")}})),jQuery("#jlow_fabrik_easyadmin_modal___listas-auto-complete").prop("disabled",!1),jQuery("#easyadmin_modal___type").trigger("change"),jQuery('input[name="easyadmin_modal___show_in_list"]').trigger("change",{button:"new-element"}),jQuery('label[for="easyadmin_modal___label_advanced_link"]').trigger("click"),jQuery("#easyadmin_modal___options_dropdown").trigger("chosen:updated"),jQuery("#easyadmin_modal___label").empty(),jQuery("#easyadmin_modal___father").empty(),jQuery("#easyadmin_modal___options_dropdown").parent().find("#easyadmin_modal___options_dropdown_chosen").css("width","95%"),jQuery("#easyadmin_modal___trash").closest(".fabrikElementContainer").addClass("fabrikHide")})),e.find("button").css({"min-height":"30px","font-size":"12px",width:"100%","border-radius":"12px",color:"#011627","background-color":"#e3ecf1"}),a.find("button").css({width:"100%","margin-bottom":"8px","font-size":"14px"})},sortColumns:function(){var e=this,a={},t=jQuery("#easyadmin_modal___viewLevel_list").val(),i=this.options.baseUri+"index.php?option=com_fabrik&format=raw&task=plugin.pluginAjax&g=list&plugin=easyadmin&method=getUsersAdmins";a.viewLevel=t,jQuery.ajax({url:i,method:"post",data:a}).done((function(a){a=JSON.parse(a);const t=document.getElementById("list_"+jQuery("[name=listid]").val()+"_com_fabrik_"+jQuery("[name=listid]").val()),i=a.map((e=>e.id));if(i.push(e.options.owner_id),("undefined"==typeof Sortable||null==t||i.indexOf(e.options.user.id)<0)&&!e.options.isAdmin)return;const s=e.getColumnOrder(t),o=t.querySelector("thead tr");Sortable.create(o,{animation:150,filter:"th:nth-last-child(-n+2)",preventOnFilter:!1,onEnd:function(a){var i=[];const o=a.oldIndex,n=a.newIndex;if(o==n)return;Fabrik.loader.start(jQuery(".fabrik-list"),Joomla.JText._("COM_FABRIK_LOADING")),t.querySelectorAll("tbody tr").forEach((function(e){const a=Array.from(e.children),t=a.splice(o,1)[0];a.splice(n,0,t),e.innerHTML="",a.forEach((function(a){e.appendChild(a)}))}));const l=e.getColumnOrder(t),r=l.length-2;switch(!0){case 0==n:idOrder=-1;break;case n>=r:idOrder=-2;break;default:idOrder=l[n-1].order.replace("_order","")}i.push({idOrder:idOrder,idAtual:s[o].order.replace("_order","")}),e.saveEvent("columns",i[0])}})})).fail((function(t,s,o){var n={url:i,data:a,error:o,status:s,jq:t};e.saveLogs(n)}))},getColumnOrder:function(e){const a=e.querySelector("thead tr").querySelectorAll("th");return Array.from(a).map((e=>({name:e.classList[2],order:e.classList[3]})))},setRelationshipLockedMessage:function(){jQuery("#jlow_fabrik_easyadmin_modal___listas-auto-complete").siblings("p.delete-paragraph").remove();var e=jQuery('<p class="delete-paragraph"></p>').text(Joomla.JText._("PLG_FABRIK_LIST_EASY_ADMIN_ELEMENT_TEXT_RELATIONSHIP_LOCKED"));jQuery("#jlow_fabrik_easyadmin_modal___listas-auto-complete").after(e),e.css({"font-size":"12px","margin-top":"2px","line-height":"15px"})}});return FbListEasyadmin}));